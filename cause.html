<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love youu <3 ğŸ’–</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="./cause.css">
    <style>
       
    </style>
</head>
<body>
    <div class="custom-cursor">
        <svg viewBox="0 0 24 24">
            <path fill="#ff69b4" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
    </div>

    <div class="container">
        <h1>Happy Birthday Becca ğŸ’–</h1>
        
        <div id="reasons-container"></div>
        
        <button class="shuffle-button">Click Here... ğŸ’•</button>
        <div class="reason-counter"></div>

        <div class="ending-section">
            <div class="teddy-hug">
                <img src="./d1.jpg" alt="Teddy Hug">
            </div>
            <div class="ending-text">You're the BESTEST ! ğŸ’–</div>
        </div>

        <div id="song-area" style="text-align:center; margin-top:2rem;">
            <h3 style="color:#ff69b4; font-family: 'Dancing Script', cursive;">A Little Song For You</h3>
            <audio id="shared-audio" controls preload="auto" style="width:90%; max-width:600px; margin-top:1rem;">
                <source src="cigarette_after_sex_-_Apocalypse_(mp3.pm).mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <div>
                <button id="continue-btn" class="goodbye-btn" style="margin-top:1rem;">Continue to Memories ğŸ’</button>
            </div>
        </div>
    </div>

    <script src="cause.js"></script>
    <script>
        (function(){
            const audio = document.getElementById('shared-audio');
            const cont = document.getElementById('continue-btn');
            const STORAGE_KEY = 'sharedAudioState';

            function saveState(){
                try{
                    const state = {
                        src: audio.currentSrc || audio.querySelector('source')?.src || '',
                        currentTime: audio.currentTime || 0,
                        paused: audio.paused,
                        timestamp: Date.now()
                    };
                    sessionStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                } catch(e){}
            }

            // Try to resume from storage if present
            try{
                const raw = sessionStorage.getItem(STORAGE_KEY);
                if(raw){
                    const s = JSON.parse(raw);
                    const src = audio.querySelector('source')?.src || '';
                    if(s && s.src && src && s.src.endsWith(src.split('/').pop())){
                        audio.addEventListener('loadedmetadata', ()=>{
                            if(s.currentTime && s.currentTime < audio.duration) audio.currentTime = s.currentTime;
                            if(!s.paused) audio.play().catch(()=>{});
                        });
                    }
                }
            } catch(e){}

            // Autoplay attempt, fallback to overlay if blocked
            // Attempt autoplay; if blocked user can use audio controls.
            audio.play().then(()=>{
                saveState();
            }).catch(()=>{
                // autoplay blocked â€” no overlay shown; user may press the audio control
            });

            // Periodically save state
            const saveInterval = setInterval(saveState, 500);
            window.addEventListener('pagehide', saveState);
            window.addEventListener('beforeunload', saveState);

            cont.addEventListener('click', ()=>{
                saveState();
                document.body.style.transition = 'opacity 0.9s';
                document.body.style.opacity = 0;
                setTimeout(()=> window.location.href = 'last.html', 900);
            });
        })();
    </script>
</body>
</html>